<section fxLayoutAlign="center center">
  <form #authForm="ngForm" (ngSubmit)="onSubmit()">
    <mat-card>
      <mat-card-header>
        <mat-card-title>
          <div fxFlex fxLayoutAlign="start center">
            <mat-icon svgIcon="logo" class="logo"></mat-icon>
            <span>Lime Tracker</span>
          </div>
        </mat-card-title>
        <mat-card-subtitle *ngIf="!signUpMode">Welcome again!</mat-card-subtitle>
        <mat-card-subtitle *ngIf="signUpMode">
          Register to the best epilepsy journal!
        </mat-card-subtitle>
      </mat-card-header>
      <img *ngIf="imageUrl" mat-card-image width="400" height="200" [src]="imageUrl" />

      <ng-container *ngIf="isLoading">
        <mat-card-content fxLayout="column" fxLayoutGap="1rem" fxLayoutAlign="center center">
          <mat-progress-spinner mode="indeterminate"></mat-progress-spinner>
        </mat-card-content>
      </ng-container>

      <ng-container *ngIf="!isLoading">
        <mat-card-content fxLayout="column" fxLayoutGap="1rem">

          <mat-error *ngIf="signUpMode && error">
          <ng-container [ngSwitch]="error">
            <span *ngSwitchCase="'auth/email-already-in-use'">Email already taken</span>
            <span *ngSwitchCase="'auth/weak-password'">Password is too weak</span>
            <span *ngSwitchDefault>Registration failed - try agian later</span>
          </ng-container>
          </mat-error>
          <mat-error *ngIf="!signUpMode && error">Authentication failed - please provide valid credentials</mat-error>

          <mat-form-field *ngIf="signUpMode">
            <input
              type="text"
              name="name"
              id="name"
              placeholder="Your name"
              min="1"
              max="100"
              required
              matInput
              [(ngModel)]="authData.name"
              #nameInput="ngModel"
            />
            <mat-error *ngIf="nameInput.hasError('required')">Your name is required</mat-error>
            <mat-error *ngIf="!nameInput.hasError('required')">Your name is invalid</mat-error>
          </mat-form-field>
          <mat-form-field>
            <input
              type="email"
              name="email"
              id="email"
              placeholder="Your email"
              email
              max="255"
              required
              matInput
              [(ngModel)]="authData.email"
              #emailInput="ngModel"
            />
            <mat-error *ngIf="emailInput.hasError('required')">Email is required</mat-error>
            <mat-error *ngIf="!emailInput.hasError('required')">Email is invalid</mat-error>
          </mat-form-field>
          <mat-form-field>
            <input
              type="password"
              name="password"
              id="password"
              placeholder="Your password"
              required
              minlength="6"
              max="100"
              matInput
              [(ngModel)]="authData.password"
              #passwordInput="ngModel"
            />
            <mat-error *ngIf="!signUpMode">Please provide valid passowrd</mat-error>
            <mat-error *ngIf="signUpMode">Has to be 6 - 100 characters long</mat-error>
          </mat-form-field>
          <mat-form-field *ngIf="signUpMode">
            <input
              type="password"
              name="confirmPassword"
              id="confirmPassword"
              placeholder="Confirm password"
              required
              [compareValidator]="passwordInput"
              matInput
              [(ngModel)]="authData.confirmPassword"
              #confirmPasswordInput="ngModel"
            />
            <mat-error *ngIf="confirmPasswordInput.hasError('required')"
              >Confirm password is required</mat-error
            >
            <mat-error *ngIf="!confirmPasswordInput.hasError('required')"
              >Password and confirm password must be the same</mat-error
            >
          </mat-form-field>
        </mat-card-content>
        <mat-card-actions>
          <button type="submit" mat-raised-button color="primary" [disabled]="!authForm.valid">
            {{ signUpMode ? "Register" : "Login" }}
          </button>
        </mat-card-actions>
      </ng-container>
    </mat-card>
  </form>
</section>
