<ng-container *ngIf="report$ | async as report; else loading">
  <mat-toolbar class="page-header" role="heading">
    <h1>
      Reports
      <span *ngIf="report">
        from {{ report.year | startOf | moment: "L" }} to {{ report.year | endOf | moment: "L" }}
      </span>
    </h1>
  </mat-toolbar>

  <main>
    <p *ngIf="!report">No reports found!</p>

    <mat-list *ngIf="report">
      <ng-container *ngFor="let monthData of report.monthsData.slice().reverse(); index as reverseMonth">
        <ng-container *ngIf="monthData.length">
        <div mat-subheader>
          {{ report.year | startOf: 11 - reverseMonth | moment: "LL" }} -
          {{ report.year | endOf: 11 - reverseMonth | moment: "LL" }}
        </div>

        <mat-list-item *ngFor="let case of monthData">
          <mat-icon *ngIf="case.event" mat-list-icon>event</mat-icon>
          <div *ngIf="case.event" mat-line>{{ case.event.name }}</div>
          <div *ngIf="case.event" mat-line class="mat-line-secondary">
            {{ case.event.occurred | moment: "LL" }}
          </div>

          <mat-icon *ngIf="case.seizure" mat-list-icon>warning</mat-icon>
          <div *ngIf="case.seizure" mat-line>
            Seizure occured: {{ case.seizure.occurred | moment: "LLL" }}
          </div>
          <div *ngIf="case.seizure" mat-line class="mat-line-secondary">
            <span>Type: {{ case.seizure.type }}</span>
            <span *ngIf="case.seizure.trigger"> | Trigger: {{ case.seizure.trigger }}</span>
          </div>
          <div *ngIf="case.seizure" mat-line class="mat-line-secondary">
            Duration: {{ case.seizure.duration | humanize }}
          </div>

          <mat-icon *ngIf="case.medicament" mat-list-icon>medication</mat-icon>
          <div *ngIf="case.medicament" mat-line>
            {{ case.medicament.name }}: {{ case.medicament.doses.morning }} -
            {{ case.medicament.doses.noon }} - {{ case.medicament.doses.evening }}
          </div>
          <div *ngIf="case.medicament" mat-line class="mat-line-secondary">
            {{ case.medicament.startDate | moment: "LL" }}
          </div>
        </mat-list-item>

        <mat-divider></mat-divider>
      </ng-container>
      </ng-container>
    </mat-list>
  </main>
</ng-container>

<ng-template #loading>
  <mat-progress-spinner mode="indeterminate"></mat-progress-spinner>
</ng-template>
