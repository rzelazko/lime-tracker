<app-yearsnav (onYearSelect)="onYearSelect($event)"></app-yearsnav>

<ng-container *ngIf="report$ | async as report; else loading">
  <mat-toolbar class="page-header" role="heading">
    <h1>
      <ng-container i18n="@@title-reports">Reports</ng-container>
      <span *ngIf="report"> </span>
      <span *ngIf="report" i18n="@@title-reports-until-from">until {{ report.dateTo | moment: "L" }} (from {{ report.dateFrom | moment: "L" }})</span>
    </h1>
  </mat-toolbar>

  <main>
    <p *ngIf="!report" i18n="@@reports-no-data">No reports found!</p>

    <mat-list *ngIf="report">
      <ng-container *ngFor="let monthData of report.monthsData; index as monthIndex">
        <div mat-subheader>
          {{ monthData.month | startOf | moment: "LL" }} -
          {{ monthData.month | endOf | moment: "LL" }}
        </div>

        <mat-list-item *ngFor="let case of monthData.data">
          <mat-icon *ngIf="case.event" mat-list-icon>event</mat-icon>
          <div *ngIf="case.event" mat-line>{{ case.event.name }}</div>
          <div *ngIf="case.event" mat-line class="mat-line-secondary">
            {{ case.event.occurred | moment: "LL" }}
          </div>

          <mat-icon *ngIf="case.seizure" mat-list-icon>warning</mat-icon>
          <div *ngIf="case.seizure" mat-line i18n="@@reports-seizure-name">Seizure: {{ case.seizure.occurred | moment: "LLL" }}</div>
          <div *ngIf="case.seizure" mat-line class="mat-line-secondary">
            <span i18n="@@reports-seizure-type">Type: {{ case.seizure.type }}</span>
            <span *ngIf="case.seizure.trigger" i18n="@@reports-seizure-trigger">| Trigger: {{ case.seizure.trigger }}</span>
          </div>
          <div *ngIf="case.seizure" mat-line class="mat-line-secondary" i18n="@@reports-seizure-duration">Duration: {{ case.seizure.duration | humanize }}</div>

          <mat-icon *ngIf="case.medicament" mat-list-icon>medication</mat-icon>
          <div *ngIf="case.medicament" mat-line>
            {{ case.medicament.name }}: {{ case.medicament.doses.morning }} -
            {{ case.medicament.doses.noon }} - {{ case.medicament.doses.evening }}
          </div>
          <div *ngIf="case.medicament" mat-line class="mat-line-secondary">
            {{ case.medicament.startDate | moment: "LL" }}
          </div>
        </mat-list-item>
        <mat-list-item *ngIf="!monthData.data.length">
          <mat-icon mat-list-icon>info_outline</mat-icon>
          <div mat-line class="mat-line-secondary" i18n="@@no-data">No data</div>
        </mat-list-item>

        <mat-divider></mat-divider>
      </ng-container>
    </mat-list>
  </main>
</ng-container>

<ng-template #loading>
  <mat-progress-spinner mode="indeterminate"></mat-progress-spinner>
</ng-template>
