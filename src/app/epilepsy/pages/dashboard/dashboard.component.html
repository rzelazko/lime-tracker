<mat-toolbar class="page-header" role="heading">
  <h1 i18n="@@title-dashboard">Dashboard</h1>
</mat-toolbar>

<main>
  <section class="actions" fxLayout="column" fxLayoutAlign="center stretch">
    <mat-card>
      <mat-card-content fxLayout="row wrap" fxLayoutAlign="space-around center">
        <a mat-raised-button color="warn" routerLink="/epilepsy/seizures/add" i18n="@@dashboard-action-add-seizure">Attack!</a>
        <a mat-raised-button color="primary" routerLink="/epilepsy/medicaments/add" i18n="@@dashboard-action-add-medicament">Medicament</a>
        <a mat-raised-button color="basic" routerLink="/epilepsy/events/add" i18n="@@dashboard-action-add-event">Event</a>
      </mat-card-content>
    </mat-card>
  </section>

  <section
    class="info"
    fxLayout="column"
    fxLayout.gt-xs="row"
    fxLayoutGap="1em"
    fxLayoutAlign="center stretch"
  >
    <mat-card
      class="last-seizure"
      *ngIf="lastSeizures$ | async as lastSeizures; else loadingSeizures"
    >
      <mat-card-title-group>
        <mat-card-title i18n="@@dashboard-title-last-seizure">Last seizure</mat-card-title>
        <mat-card-subtitle *ngIf="lastSeizures.length === 1">{{
          lastSeizures[0].occurred | moment: "LL"
        }}</mat-card-subtitle>
      </mat-card-title-group>
      <mat-card-content>
        <h3 i18n="@@dashboard-time-since-last-seizure">Time since last seizure:</h3>
        <p class="mat-display-3" *ngIf="lastSeizures.length !== 1" i18n="@@dashboard-time-since-last-seizure-unknown">unknown</p>
        <p class="mat-display-3" *ngIf="lastSeizures.length === 1">
          {{ lastSeizures[0].occurred | timeSince | humanize }}
        </p>
      </mat-card-content>
    </mat-card>

    <ng-template #loadingSeizures>
      <mat-card class="last-seizure">
        <mat-card-title-group>
          <mat-card-title i18n="@@dashboard-title-last-seizure">Last seizure</mat-card-title>
        </mat-card-title-group>
        <mat-progress-spinner mode="indeterminate"></mat-progress-spinner>
      </mat-card>
    </ng-template>

    <mat-card class="medicaments">
      <mat-card-title-group>
        <mat-card-title i18n="@@dashboard-title-current-medicaments">Current medicaments</mat-card-title>
      </mat-card-title-group>
      <mat-card-content>
        <mat-list
          fxLayout="row wrap"
          *ngIf="medicaments$ | async as medicaments; else loadingMedicament"
        >
          <mat-list-item *ngFor="let medicament of medicaments">
            <mat-icon mat-list-icon>medication</mat-icon>
            <div mat-line>{{ medicament.name }}</div>
            <div
              mat-line
              class="dose"
              [matTooltip]="
                medicament.doses.morning +
                ' - ' +
                medicament.doses.noon +
                ' - ' +
                medicament.doses.evening
              "
            >
              {{ medicament.doses.morning }} - {{ medicament.doses.noon }} -
              {{ medicament.doses.evening }}
            </div>
          </mat-list-item>

          <mat-list-item *ngIf="!medicaments.length">
            <mat-icon mat-list-icon>info_outline</mat-icon>
            <div mat-line i18n="@@no-data">No data</div>
          </mat-list-item>
        </mat-list>

        <ng-template #loadingMedicament>
          <mat-progress-spinner mode="indeterminate"></mat-progress-spinner>
        </ng-template>
      </mat-card-content>
    </mat-card>
  </section>
</main>
